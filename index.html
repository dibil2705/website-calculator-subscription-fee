<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Калькулятор</title>
  <style>
    :root{
      --bg:#070a12;
      --card1: rgba(255,255,255,.075);
      --card2: rgba(255,255,255,.035);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);

      --btn: rgba(255,255,255,.055);
      --btn2: rgba(255,255,255,.03);

      --accent: rgba(110,231,255,.14);
      --accentStroke: rgba(110,231,255,.32);

      --danger: rgba(255,120,120,.12);
      --dangerStroke: rgba(255,120,120,.35);

      --shadow: 0 28px 90px rgba(0,0,0,.65);
      --r: 24px;
    }

    *{ box-sizing: border-box; }

    body{
      margin:0;
      min-height:100dvh;
      display:grid;
      place-items:center;
      padding: 24px;
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1100px 720px at 18% 12%, rgba(54, 170, 180, .28), transparent 58%),
        radial-gradient(900px 640px at 84% 66%, rgba(105, 80, 190, .26), transparent 60%),
        linear-gradient(180deg, #0b1320, var(--bg));
    }

    .app{
      width: min(540px, 100%);
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, var(--card1), var(--card2));
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    .top{
      padding: 16px 16px 14px;
      border-bottom: 1px solid var(--stroke2);
      display:grid;
      gap: 12px;
    }

    .row{
      display:flex;
      gap: 12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .pill{
      flex: 1;
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.22);
      border-radius: 18px;
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      min-height: 62px;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.06),
        inset 0 -1px 0 rgba(0,0,0,.25);
    }

    .label{ font-size: 12px; color: var(--muted); }
    .big{ font-size: 22px; font-weight: 850; letter-spacing: .2px; }

    .rateBox{
      display:flex;
      align-items:center;
      gap: 10px;
      justify-content:flex-end;
    }

    input{
      width: 110px;
      border: 1px solid var(--stroke2);
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      color: var(--text);
      padding: 10px 10px;
      font-size: 16px;
      font-weight: 800;
      outline: none;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }

    .btn{
      appearance:none;
      border: 1px solid var(--stroke2);
      background: linear-gradient(180deg, var(--btn), var(--btn2));
      color: var(--text);
      border-radius: 16px;
      padding: 12px 10px;
      font-size: 16px;
      font-weight: 850;
      cursor:pointer;
      user-select:none;
      transition: transform .06s ease, filter .15s ease, background .15s ease, border-color .15s ease;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.08),
        inset 0 -1px 0 rgba(0,0,0,.35);
    }
    .btn:hover{ filter: brightness(1.06); }
    .btn:active{ transform: translateY(1px); }

    .accent{ border-color: var(--accentStroke); background: linear-gradient(180deg, rgba(110,231,255,.16), rgba(110,231,255,.06)); }
    .danger{ border-color: var(--dangerStroke); background: linear-gradient(180deg, rgba(255,120,120,.14), rgba(255,120,120,.06)); }

    .formulaWrap{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
    }
    .code{
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.22);
      padding: 8px 10px;
      border-radius: 999px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      color: rgba(255,255,255,.85);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      padding: 16px;
    }

    .wide{ grid-column: span 2; }
    .ghost{ opacity:.45; cursor:not-allowed; }

    .screenNums{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 14px;
      width: 100%;
    }
    .stack{ display:flex; flex-direction:column; gap: 4px; }
    .right{ text-align:right; }

    @media (max-width: 420px){
      input{ width: 96px; }
      .big{ font-size: 20px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top">
      <div class="row">
        <div class="pill">
          <div class="stack">
            <div class="label">₽/мин</div>
            <div class="big" id="rateDisplay">20</div>
          </div>

          <div class="rateBox">
            <input id="rateInput" type="number" inputmode="numeric" min="0" step="1" value="20" aria-label="Цена за минуту">
            <button class="btn accent" id="rateSet" type="button" aria-label="Применить цену">OK</button>
          </div>
        </div>
      </div>

      <div class="formulaWrap">
        <div class="label">Формула</div>
        <div class="code" id="formula" title="Полная формула"></div>
      </div>

      <div class="row">
        <div class="pill">
          <div class="screenNums">
            <div class="stack">
              <div class="label">n</div>
              <div class="big" id="nDisplay">0</div>
            </div>
            <div class="stack right">
              <div class="label">итог</div>
              <div class="big" id="sumDisplay">—</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="grid" id="keys">
      <button type="button" class="btn danger wide" data-action="clear">C</button>
      <button type="button" class="btn danger" data-action="back">⌫</button>
      <button type="button" class="btn ghost" disabled aria-hidden="true"></button>

      <button type="button" class="btn" data-digit="7">7</button>
      <button type="button" class="btn" data-digit="8">8</button>
      <button type="button" class="btn" data-digit="9">9</button>
      <button type="button" class="btn ghost" disabled aria-hidden="true"></button>

      <button type="button" class="btn" data-digit="4">4</button>
      <button type="button" class="btn" data-digit="5">5</button>
      <button type="button" class="btn" data-digit="6">6</button>
      <button type="button" class="btn ghost" disabled aria-hidden="true"></button>

      <button type="button" class="btn" data-digit="1">1</button>
      <button type="button" class="btn" data-digit="2">2</button>
      <button type="button" class="btn" data-digit="3">3</button>
      <button type="button" class="btn ghost" disabled aria-hidden="true"></button>

      <button type="button" class="btn wide" data-digit="0">0</button>
      <button type="button" class="btn accent wide" data-action="equals">=</button>
    </div>
  </div>

  <script>
    (() => {
      const nDisplay = document.getElementById('nDisplay');
      const sumDisplay = document.getElementById('sumDisplay');
      const keys = document.getElementById('keys');

      const rateDisplay = document.getElementById('rateDisplay');
      const rateInput = document.getElementById('rateInput');
      const rateSet = document.getElementById('rateSet');

      const formulaEl = document.getElementById('formula');

      let nStr = "0";
      let rate = 20;

      const BASE = 1200 + 500;
      const MULT_FIXED = 3 * 31;

      const fmt = (x) => new Intl.NumberFormat("ru-RU").format(x);

      const renderFormula = () => {
        formulaEl.textContent = `1200 + 500 + n × ${rate} × 3 × 31`;
        formulaEl.title = formulaEl.textContent;
      };

      function normalizeN(){
        nStr = nStr.replace(/^0+(?=\d)/, "");
        if (!nStr) nStr = "0";
      }
      function renderN(){ nDisplay.textContent = nStr; }

      function appendDigit(d){
        nStr = (nStr === "0") ? d : (nStr + d);
        normalizeN(); renderN();
      }
      function backspace(){
        nStr = (nStr.length <= 1) ? "0" : nStr.slice(0, -1);
        normalizeN(); renderN();
      }
      function clearAll(){
        nStr = "0"; renderN();
        sumDisplay.textContent = "—";
      }
      function compute(){
        const n = Number.parseInt(nStr, 10) || 0;
        const total = BASE + n * rate * MULT_FIXED;
        sumDisplay.textContent = fmt(total);
      }

      function setRateFromInput(){
        const v = Number.parseInt(rateInput.value, 10);
        rate = Number.isFinite(v) && v >= 0 ? v : 20;
        rateInput.value = String(rate);
        rateDisplay.textContent = String(rate);
        renderFormula();
      }

      rateSet.addEventListener('click', setRateFromInput);
      rateInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') setRateFromInput(); });

      keys.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn || btn.disabled) return;

        const digit = btn.getAttribute('data-digit');
        const action = btn.getAttribute('data-action');

        if (digit !== null) appendDigit(digit);
        else if (action === "back") backspace();
        else if (action === "clear") clearAll();
        else if (action === "equals") compute();
      });

      window.addEventListener('keydown', (e) => {
        if (e.target === rateInput) return;
        if (e.key >= '0' && e.key <= '9') return appendDigit(e.key);
        if (e.key === 'Backspace') { e.preventDefault(); return backspace(); }
        if (e.key === 'Escape') return clearAll();
        if (e.key === 'Enter' || e.key === '=') return compute();
      });

      // init
      rateDisplay.textContent = String(rate);
      rateInput.value = String(rate);
      renderFormula();
      renderN();
    })();
  </script>
</body>
</html>
